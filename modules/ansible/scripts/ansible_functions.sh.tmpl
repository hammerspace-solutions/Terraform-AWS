#!/bin/bash

# Library of functions for the Ansible Controller

# --- State and Config Files ---
LOCK_FILE="/var/ansible_initial_setup.done"
STATUS_DIR="/var/run/ansible_jobs_status"


# --- Function: check_job_status ---
# Allows a script to check if a previous job succeeded.
# Usage: check_job_status "10-clients-ssh-keys.sh"
# Exits with 0 if the job was successful, 1 otherwise.
check_job_status() {
    local job_name="$1"
    if [ -f "$STATUS_DIR/$job_name.success" ]; then
        return 0 # Success
    else
        return 1 # Failure or not run
    fi
}

# --- Function: run_initial_setup ---
# Performs the one-time setup. It no longer contains the main logic itself,
# but instead PREPARES the very first job script using Terraform variables.
run_initial_setup() {
    echo "Preparing the initial system configuration job..."
    sudo touch "$LOCK_FILE"
    echo "Initial setup script has been created. The daemon will now pick it up and execute it."
}
